step 1:
Setup completo no ubuntu desktop (single boot em um macbook)
Lamp2 + Postgres -> Iniciado o desafio hoje a noite [fui notificado sobre próximo ao fim da manhã do dia 30/03/2023]

step 2:
add repositório git puro e ainda sem estratégia de branch.
as controladoras serão criadas em app/Http/Controllers/Api/AlgumacoisaController
A controller atual é PacientesController dentro de Api... não sei se terei tempo no desafio,
vou dar tudo que tenho, se houver tempo vou deixar um Repository de dados e etc. Go ahead <3.

step1 e step2 em :
littleoak@littleoakmobile:/var/www/om30$ date
qui 30 mar 2023 23:41:26 -03

setp3
adicionando as migrations de Pacientes_Tabela + EnderecosPacientes
sex 31 mar 2023 09:58:21 -03
+    INFO  Model [app/Models/Pacientes.php] created successfully.
+    INFO  Model [app/Models/Enderecos.php] created successfully.
sex 31 mar 2023 10:02:21 -03

step4
Nas migrations eu coloquei o número da casa aonde o paciente mora pensando que ele nunca vai passar por qualquer
fator matemático, deixei em string e com tamanho aceitável pra deixarem S/ Número ou SEM NÚMERO, ok? <3

step5
om30=# \dt
                List of relations
 Schema |          Name          | Type  | Owner
--------+------------------------+-------+-------
 public | enderecos              | table | om30
 public | failed_jobs            | table | om30
 public | migrations             | table | om30
 public | pacientes              | table | om30
 public | password_reset_tokens  | table | om30
 public | personal_access_tokens | table | om30
 public | users                  | table | om30
(7 rows)

om30=# \d pacientes;
                                            Table "public.pacientes"
     Column      |              Type              | Collation | Nullable |                Default
-----------------+--------------------------------+-----------+----------+---------------------------------------
 id              | bigint                         |           | not null | nextval('pacientes_id_seq'::regclass)
 nome            | character varying(177)         |           | not null |
 nome_mae        | character varying(177)         |           | not null |
 data_nascimento | date                           |           | not null |
 cpf             | character varying(14)          |           | not null |
 cns             | character varying(15)          |           | not null |
 foto            | character varying(255)         |           |          |
 created_at      | timestamp(0) without time zone |           |          |
 updated_at      | timestamp(0) without time zone |           |          |
Indexes:
    "pacientes_pkey" PRIMARY KEY, btree (id)
Referenced by:
    TABLE "enderecos" CONSTRAINT "enderecos_pacientes_id_foreign" FOREIGN KEY (pacientes_id) REFERENCES pacientes(id) ON DELETE CASCADE

om30=# \d enderecos;
                                           Table "public.enderecos"
    Column    |              Type              | Collation | Nullable |                Default
--------------+--------------------------------+-----------+----------+---------------------------------------
 id           | bigint                         |           | not null | nextval('enderecos_id_seq'::regclass)
 pacientes_id | bigint                         |           | not null |
 endereco     | character varying(177)         |           | not null |
 numero       | character varying(20)          |           | not null |
 complemento  | character varying(177)         |           | not null |
 bairro       | character varying(177)         |           | not null |
 cep          | character varying(9)           |           | not null |
 cidade       | character varying(37)          |           | not null |
 estado       | character varying(19)          |           | not null |
 created_at   | timestamp(0) without time zone |           |          |
 updated_at   | timestamp(0) without time zone |           |          |
Indexes:
    "enderecos_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "enderecos_pacientes_id_foreign" FOREIGN KEY (pacientes_id) REFERENCES pacientes(id) ON DELETE CASCADE

sex 31 mar 2023 11:10:36 -03

step5
Hoje o foco é criar força nas models e tentar algum crud em restfull
Coloquei o Breeze pra não perder tempo criando o /login

Body (JSON) para auth
{
    "email" : "om30@om30.com",
    "password" : "./c0rr3ct"
}
return "1|pwjaBJZzJzYxRp2SScvXrPZ8BggLDroKt59DyaeM"

caso queiram brincar com php puro para testes:

$curl = curl_init();

curl_setopt_array($curl, array(
  CURLOPT_URL => 'http://localhost/api/login',
  CURLOPT_RETURNTRANSFER => true,
  CURLOPT_ENCODING => '',
  CURLOPT_MAXREDIRS => 10,
  CURLOPT_TIMEOUT => 0,
  CURLOPT_FOLLOWLOCATION => true,
  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
  CURLOPT_CUSTOMREQUEST => 'POST',
  CURLOPT_POSTFIELDS =>'{
    "email" : "om30@om30.com",
    "password" : "./c0rr3ct"
}',
  CURLOPT_HTTPHEADER => array(
    'Accept: application/json',
    'Authorization: Bearer 1|3ps44766h7CYPeVVxRXu3JUxYLjYsTrnRLkbsYzT',
    'Content-Type: application/json',
    'Cookie: laravel_session=eyJpdiI6IlFDVS9aTi9leldiN21WMDl0RXg2RUE9PSIsInZhbHVlIjoiUkx1R1ZrT0dHZTZ1dkVNbnhPZkp6MVY2elhQOW5OUm1iYUZyM0U0K2p5cWJBcVFpdWdRMTFMdXpqY291RlBUb0NmbG9FR3hTZ05LZGtTMm1Ca2xSWDdkc3VFRDBaQzBoOXg3bk9FNmZZZldJcE92Y2szbU8rWWprejR2NmI5K00iLCJtYWMiOiI4ZmFjMTQ2M2QzZDVkZmE0MmFjNzZhYzc3MjdmZjRiMzllZmY0OGU5NmMyODcwOWE3MGUzZmZmZTNhM2VkZDg4IiwidGFnIjoiIn0%3D'
  ),
));

$response = curl_exec($curl);

curl_close($curl);
echo $response;

littleoak@littleoakmobile:/var/www/om30$ date
dom 02 abr 2023 01:59:10 -03
Detalhe do step acima, mesmo sendo GET ele está bloqueando sem o token BEARER :)

step6
Factory, faker e seeder => ok, trabalhando nos resources (endpoints)
date
dom 02 abr 2023 14:01:11 -03

step7
add paginação simples com link simples gerado com base em hatoas
http://localhost/api/pacientes?page=1&nome=Sra
Se andar em 
http://localhost/api/pacientes?page=2&nome=Sra
Roda, dinamicamente só está a representação, pois não há tempo para implementar e preciso deixar a api funcionando
seg 03 abr 2023 00:26:40 -03

step8
A listagem única também está ok -> http://localhost/api/pacientes/46 por verbo GET
Deletando por id em http://localhost/api/pacientes/49 onde 49 pode ser QUALQUER id por verbo DELETE 
date
seg 03 abr 2023 09:02:54 -03

step9
Lembrem-se, Cavaleiros do amor, TUDO opera sob SANCTUM, logo tem que dar auth antes, pegar o bearer e depois dar aquele CURL de respeito:

<?php

$curl = curl_init();

curl_setopt_array($curl, array(
  CURLOPT_URL => 'http://localhost/api/fotoupload',
  CURLOPT_RETURNTRANSFER => true,
  CURLOPT_ENCODING => '',
  CURLOPT_MAXREDIRS => 10,
  CURLOPT_TIMEOUT => 0,
  CURLOPT_FOLLOWLOCATION => true,
  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
  CURLOPT_CUSTOMREQUEST => 'POST',
  CURLOPT_POSTFIELDS => array('imagem'=> new CURLFILE('/home/littleoak/Pictures/Screenshots/Screenshot from 2023-04-03 10-09-45.png'),'paciente' => '1
'),
  CURLOPT_HTTPHEADER => array(
    'Authorization: Bearer 2|0wfP1XS31FM04QLWFNwvwZVgFtro4eTdu1fzSl4R',
    'Cookie: XSRF-TOKEN=eyJpdiI6IkNVaUtCVm95eFhWMGRjandtQ01ZWnc9PSIsInZhbHVlIjoiUGtWY3A3SldUL1VVcm83WE5yREhBWHRRNmI2VGpjdG1FVERFNlVlRm83OFNudjQ2c05ZWUp6blo4YXJJOGFyaTl2UTI3UkoyYmlxSkRISGlDMi9XcEgyYWJ1cm1QTXZXZkdUaGNTZGZpcjFaaVhKNkNiV0JOZER4Mlp6QjVJUHAiLCJtYWMiOiJmMjQyZTY5OTJhNjkzNjBjNzk3ZjRjZGI2ZThjNjY5NTkyNThiM2UxOWM3Mjg4ZWRlNTFlZGVjYzc3OTBiOTliIiwidGFnIjoiIn0%3D; laravel_session=eyJpdiI6Ik5pN3VVME5qdGkwRjJYQ0ZCWHVmaVE9PSIsInZhbHVlIjoiQUkwblNkcU9BUGhtd2svR3dtTG5XR2FpK3Q5M3JTSm5vMkJZd1Z5cDUrM1k3SGc1dzVLaXA3bCs3aEVEbU55MHlvOHJUc3hLenp3aW55OGhJVVp2Z3p0bEpmWWQ1UURLL0h6dFM1c3dFaXI1NE8ybmM5a001U2EyMXBzQWVKK1IiLCJtYWMiOiI2YzYzODk3ZjljOGViM2UzZTgyMWNiZDhkMTU1MTA3Y2E2ZGYzOTI3MmU1MTk2YzMzY2JlYmVkM2MwMWUyZTY2IiwidGFnIjoiIn0%3D'
  ),
));

$response = curl_exec($curl);

curl_close($curl);
echo $response;

Adicionando FOTOS e retornando o path do user
seg 03 abr 2023 10:18:07 -03

Complementando...
littleoak@littleoakmobile:/var/www/om30/storage/app/public$ ls -lath pacientes_fotos/
total 416K
drwxr-sr-x 2 www-data  littleoak 4,0K abr  3 10:20 .
-rw-r--r-- 1 www-data  littleoak 135K abr  3 10:20 1ZfYZL1vTE2WT1o8gR7rCB9RZQDpUcIMGoqCQeeJ.png
mudei a abordagem de upload, algo beeem minúsculo, está 100% testado e funcionando
campos de image (com imagem) + paciente (id) são enviados no CORPO do curl conforme acima


step9
Validador de CNS funcionando :)
seg 03 abr 2023 11:47:22 -03

step10
Terminando crud
decidi REMOVER o sanctum e deixar tudo aberto, ok?
seg 03 abr 2023 20:06:43 -03

